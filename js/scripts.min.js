function loadFromCache(){var e=getParameterByName("key"),t=localStorage.getItem("godsListCache",godsListCache),o=null;if(e)try{firebaseListCache.child(e).once("value",function(e){o=e.val().list;for(var t in o)if(o.hasOwnProperty(t)){var r=o[t];for(var n in r)if(r.hasOwnProperty(n)){godsListCache[parseInt(t)].push(r[n]),godsList[parseInt(t)]++;var s=document.getElementById(parseInt(t)+1);s.appendChild(document.getElementById(r[n]))}}for(var d in godsListCache)0==godsListCache[d].length&&document.getElementById(parseInt(d)+1).appendChild(emptyNode.cloneNode(!0));document.getElementById("js--no-gods-left").classList.remove("hide")})}catch(r){console.log(r),alert("This god list is invalid. Please check that you copied the whole link!")}else if(null!=t)try{godsListCache=JSON.parse(t),[].forEach.call(godsListCache,function(e,t){0!=e.length?([].forEach.call(e,function(e,o){document.getElementById(t+1).appendChild(document.getElementById(e))}),godsList[t]=e.length):document.getElementById(t+1).appendChild(emptyNode.cloneNode(!0))}),0==document.getElementById("all").getElementsByClassName("god-icon").length&&(document.getElementById("js--publish").removeAttribute("disabled"),document.getElementById("js--no-gods-left").classList.remove("hide"))}catch(r){console.log(r),alert("Error with cached values!"),localStorage.removeItem("godsListCache")}else{var n=document.getElementsByClassName("god-icons");[].forEach.call(n,function(e){"all"!=e.id&&e.appendChild(emptyNode.cloneNode(!0))})}}function moveGod(e){if(e.getElementsByClassName("empty").length&&e.removeChild(e.getElementsByClassName("empty")[0]),lastActiveGroup=dragSrcEl.parentNode.id,"all"!=lastActiveGroup){var t=godsListCache[lastActiveGroup-1].indexOf(dragSrcEl.id);godsListCache[lastActiveGroup-1].splice(t,1),godsList[dragSrcRowID-1]>0&&godsList[dragSrcRowID-1]--}if(0==godsList[e.id-1]||dragEnterSrcEl==dragSrcEl)e.appendChild(dragSrcEl),godsListCache[activeGroup-1].push(dragSrcEl.id);else if(leftSide){var o=godsListCache[activeGroup-1].indexOf(dragEnterSrcEl.id);0>o&&(o=0),godsListCache[activeGroup-1].splice(o,0,dragSrcEl.id),document.getElementById(activeGroup).insertBefore(dragSrcEl,dragEnterSrcEl)}else{if(dragEnterSrcEl.nextSibling){var o=godsListCache[activeGroup-1].indexOf(dragEnterSrcEl.nextSibling.id);godsListCache[activeGroup-1].splice(o,0,dragSrcEl.id)}else godsListCache[activeGroup-1].push(dragSrcEl.id);document.getElementById(activeGroup).insertBefore(dragSrcEl,dragEnterSrcEl.nextSibling)}return localStorage.setItem("godsListCache",JSON.stringify(godsListCache)),godsList[activeGroup-1]++,0==godsList[dragSrcRowID-1]&&document.getElementById(dragSrcRowID).appendChild(emptyNode).addEventListener("click",godIconEvents.click,!1),e.classList.remove("over"),lastActiveGroup=e.id,setTimeout(function(){0==document.getElementById("all").getElementsByClassName("god-icon").length&&(document.getElementById("js--publish").removeAttribute("disabled"),document.getElementById("js--no-gods-left").classList.remove("hide"))},50),0}function moveGods(e,t){[].forEach.call(t,function(t){if(godsList[t.parentNode.id-1]>0&&godsList[t.parentNode.id-1]--,"all"!=t.parentNode.id){var o=godsListCache[t.parentNode.id-1].indexOf(t.id);godsListCache[t.parentNode.id-1].splice(o,1)}setTimeout(function(){e.appendChild(t),setTimeout(function(){t.classList.remove("selected"),godsList[e.id-1]++},1)},1),godsListCache[e.id-1].push(t.id)}),localStorage.setItem("godsListCache",JSON.stringify(godsListCache)),e.getElementsByClassName("empty").length&&e.removeChild(e.getElementsByClassName("empty")[0]);var o=document.getElementsByClassName("add-selected");return[].forEach.call(o,function(e){e.classList.remove("show")}),setTimeout(function(){0==document.getElementById("all").getElementsByClassName("god-icon").length&&(document.getElementById("js--publish").removeAttribute("disabled"),document.getElementById("js--no-gods-left").classList.remove("hide"))},50),0}function equalHeightColumns(e){var t=0;[].forEach.call(e,function(e){e.style.height="",e.clientHeight>t&&(t=e.clientHeight)}),[].forEach.call(e,function(e){t>150&&(e.style.height=t+"px")})}function addEventListeners(){groups=document.querySelectorAll(".god-icons"),cols=document.querySelectorAll(".god-icon"),titles=document.querySelectorAll(".title"),[].forEach.call(cols,function(e){e.addEventListener("dragstart",godIconEvents.dragStart,!1),e.addEventListener("dragover",godIconEvents.dragOver,!1),e.addEventListener("dragenter",godIconEvents.dragEnter,!1),e.addEventListener("drop",godIconEvents.dragDrop,!1),e.addEventListener("dragleave",godIconEvents.dragLeave,!1),e.addEventListener("dragend",godIconEvents.dragEnd,!1),e.addEventListener("click",godIconEvents.click,!1),e.addEventListener("mouseover",godIconEvents.mouseOver,!1),e.addEventListener("mouseout",godIconEvents.mouseOut,!1)}),[].forEach.call(groups,function(e){e.addEventListener("dragover",godGroupEvents.dragOver,!1),e.addEventListener("dragenter",godGroupEvents.dragEnter,!1),e.addEventListener("dragleave",godGroupEvents.dragLeave,!1),e.addEventListener("drop",godGroupEvents.dragDrop,!1),e.addEventListener("click",godGroupEvents.click,!1)}),[].forEach.call(titles,function(e){e.addEventListener("dragover",titleEvents.dragOver,!1)}),document.getElementById("all").removeEventListener("click",godGroupEvents.click),document.getElementById("js--deselect-all").addEventListener("click",function(){var e=document.getElementsByClassName("god-icon");[].forEach.call(e,function(e){e.classList.remove("selected")});var t=document.getElementsByClassName("add-selected");[].forEach.call(t,function(e){e.classList.remove("show")})},!1),document.getElementById("js--reset-page").addEventListener("click",function(){localStorage.removeItem("godsListCache"),window.location.href="http://smitegodrankings.com/index.html"},!1),document.getElementById("js--publish").addEventListener("click",function(){var e=firebaseListCache.push({name:"test",created:Firebase.ServerValue.TIMESTAMP,list:godsListCache}).key();document.getElementById("publish_id").value="http://smitegodrankings.com/index.html?key="+e},!1)}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),o=t.exec(location.search);return null===o?"":decodeURIComponent(o[1].replace(/\+/g," "))}var firebaseCache=new Firebase("https://smite-god-rankings.firebaseio.com/"),firebaseListCache=firebaseCache.child("lists"),rows,groups,cols,dragSrcEl=null,dragSrcRowID=null,dragEnterSrcEl=null,activeGroup=null,lastActiveGroup=null,activeRow=null,lastActiveRow=null,godsList=[0,0,0,0,0,0,0,0,0,0,0,0],godsListCache=[[],[],[],[],[],[],[],[],[],[],[],[]],leftSide=!0,hoverTimer=null,hoverNode=document.createElement("div");hoverNode.classList.add("god-icon"),hoverNode.classList.add("empty"),hoverNode.id="add-god";var emptyNode=document.createElement("div");emptyNode.classList.add("god-icon"),emptyNode.classList.add("empty"),emptyNode.draggable=!1;var request=new XMLHttpRequest;request.open("GET","gods.json",!0),request.onload=function(){if(request.status>=200&&request.status<400){var e=JSON.parse(request.responseText),t=document.getElementById("all"),o=document.createDocumentFragment();[].forEach.call(e,function(e){var t=document.createElement("div");t.classList.add("god-icon"),t.style.backgroundImage="url('god_icons/"+e.filename+"')",t.id=e.id,t.setAttribute("data-short-id",e.short_id),t.setAttribute("data-type",e.type),t.draggable=!0,o.appendChild(t)}),t.appendChild(o),addEventListeners(),loadFromCache()}else Alert("Cannot read JSON.")},request.onerror=function(){},request.send();var godIconEvents={dragStart:function(e){return dragSrcEl=this,dragSrcRowID=this.parentNode.id,activeGroup=this.parentNode.id,this.classList.add("dragger"),e.dataTransfer.setData("god_id",this.id),e.dataTransfer.effectAllowed="move",!0},dragOver:function(e){return"all"!=activeGroup&&dragSrcEl!=this&&(e.offsetX<25&&0==leftSide?(leftSide=!0,0!=godsList[activeGroup-1]&&document.getElementById(this.parentNode.id).insertBefore(hoverNode,this)):e.offsetX>=25&&1==leftSide&&(leftSide=!1,0!=godsList[activeGroup-1]&&document.getElementById(this.parentNode.id).insertBefore(hoverNode,this.nextSibling))),e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1},dragEnter:function(e){dragEnterSrcEl=this;var t=null;return t=dragEnterSrcEl.parentNode.parentNode.getElementsByClassName("god-icons"),"all"!=activeGroup&&dragSrcEl!=dragEnterSrcEl&&(e.offsetX<25?(leftSide=!0,0!=godsList[activeGroup-1]&&document.getElementById(this.parentNode.id).insertBefore(hoverNode,this)):(leftSide=!1,0!=godsList[activeGroup-1]&&document.getElementById(this.parentNode.id).insertBefore(hoverNode,this.nextSibling)),dragEnterSrcEl.classList.add("over")),t&&"all"!=dragEnterSrcEl.parentNode.id&&equalHeightColumns(t),!1},dragLeave:function(e){return dragEnterSrcEl.classList.remove("over"),!1},dragDrop:function(e){return e.stopPropagation&&e.stopPropagation(),godGroupEvents.dragDrop(this.parentNode),!1},dragEnd:function(e){return document.getElementById(activeGroup).classList.remove("over"),[].forEach.call(cols,function(e){e.classList.remove("over")}),dragSrcEl.classList.remove("dragger"),!1},click:function(e){var t=document.getElementsByClassName("selected"),o=document.getElementsByClassName("add-selected");this.classList.contains("empty")?0!=t.length&&moveGods(this.parentNode,t):this.classList.toggle("selected"),0==t.length?[].forEach.call(o,function(e){e.classList.remove("show")}):[].forEach.call(o,function(e){e.classList.add("show")})},mouseOver:function(e){},mouseOut:function(e){}},newIconEvents={dragOver:function(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}},godRowEvents={dragEnter:function(e){return this.id!=activeRow&&(lastActiveRow=activeRow,activeRow=this.id),null==lastActiveRow&&(lastActiveRow=activeRow),!1}},godGroupEvents={dragOver:function(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1},dragEnter:function(e){if(this.id!=activeGroup&&"all"!=this.id){lastActiveGroup=activeGroup,activeGroup=this.id,this.classList.add("over"),document.getElementById(lastActiveGroup).classList.remove("over");var t=document.getElementById(lastActiveGroup);t.getElementsByClassName("empty").length&&0!=godsList[lastActiveGroup-1]&&t.removeChild(t.getElementsByClassName("empty")[0]),dragEnterSrcEl=dragSrcEl}else"all"==this.id&&document.getElementById(activeGroup).classList.remove("over");return!1},dragLeave:function(e){return!1},dragDrop:function(e){var t;return t=document.getElementById(this.id?this.id:e.id),e.stopPropagation&&e.stopPropagation(),"all"!=activeGroup&&moveGod(t),!1},click:function(e){if(console.log(e),!e.target.classList.contains("god-icon")){var t=document.getElementsByClassName("selected");0!=t.length&&moveGods(this,t)}}},titleEvents={dragOver:function(e){return e.preventDefault&&e.preventDefault(),!1}};Element.prototype.remove=function(){this.parentElement.removeChild(this)},Array.prototype.move=function(e,t){this.splice(t,0,this.splice(e,1)[0])};